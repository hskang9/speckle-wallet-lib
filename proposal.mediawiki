---
pip: 1 TODO: need Polkadot Improvement Proposal(PIP) repo
title: Multi-Account Hierarchy for Deterministic Wallets on interchains
author: Hyungsuk Kang(hskang9@gmail.com), TODO: Add reviewers, me with speckle team email
discussions-to: https://github.com/SpeckleOS/speckle-wallet-lib
status: Draft
type: Standards Track
category: Core
created: 2019-04-18
---

==1. Abstract==

FIXME: replace "document" with some improvement channel in polkadot

This document introduces Hierarchy deterministic wallet for polkadot/substrate to achieve following benefit:

1. Removing neccessity for backup on randomly generated keys
2. Recoverable multi-accounts for parachains
3. Selective asset sharing by derived accounts from the root

==2. Motivation==

As described in BIP44, it allows the handling of multiple currencies, multiple accounts, external and internal chains per account and millions of addresses per parachain.

==3. Related Works==

- BIP 32

BIP 32 describes the idea of deterministic wallets by extended keys using serialized byte array called "path". the path has hierarchy to identify the account for its use cases.

Serialization specifcation is shown below:

- 4 byte: version bytes (mainnet: 0x0488B21E public, 0x0488ADE4 private; testnet: 0x043587CF public, 0x04358394 private)
- 1 byte: depth: 0x00 for master nodes, 0x01 for level-1 derived keys, ....
- 4 bytes: the fingerprint of the parent's key (0x00000000 if master key)
- 4 bytes: child number. This is ser32(i) for i in xi = xpar/i, with xi the key being serialized. (0x00000000 if master key)
- 32 bytes: the chain code
- 33 bytes: the public key or private key data (serP(K) for public keys, 0x00 || ser256(k) for private keys)

Implementation is [https://github.com/cryptocoinjs/hdkey/blob/e2e55694d37441b6a60c49015036525d8315e656/lib/hdkey.js#L219 here]

- BIP 39

Mnemonic phrases are introduced to generate recoverable account which user needs to remember the secret words to regenerate private keys

Implementation [https://github.com/bitcoinjs/bip39/blob/cd6bcdbb2e1c363f72c9e04a4b7dca60b359b092/src/index.js here]

- BIP 44

BIP 44 provides specific use cases on how to implement levels of path to distinguish wallets in different protocol such as examples below:

{|
!coin
!account
!chain
!address
!path
|-
|Bitcoin
|first
|external
|first
|m / 44' / 0' / 0' / 0 / 0
|-
|Bitcoin
|first
|external
|second
|m / 44' / 0' / 0' / 0 / 1
|-
|Bitcoin
|first
|change
|first
|m / 44' / 0' / 0' / 1 / 0
|-
|Bitcoin
|first
|change
|second
|m / 44' / 0' / 0' / 1 / 1
|-
|Bitcoin
|second
|external
|first
|m / 44' / 0' / 1' / 0 / 0
|-
|Bitcoin
|second
|external
|second
|m / 44' / 0' / 1' / 0 / 1
|-
|Bitcoin
|second
|change
|first
|m / 44' / 0' / 1' / 1 / 0
|-
|Bitcoin
|second
|change
|second
|m / 44' / 0' / 1' / 1 / 1
|-
|Bitcoin Testnet
|first
|external
|first
|m / 44' / 1' / 0' / 0 / 0
|-
|Bitcoin Testnet
|first
|external
|second
|m / 44' / 1' / 0' / 0 / 1
|-
|Bitcoin Testnet
|first
|change
|first
|m / 44' / 1' / 0' / 1 / 0
|-
|Bitcoin Testnet
|first
|change
|second
|m / 44' / 1' / 0' / 1 / 1
|-
|Bitcoin Testnet
|second
|external
|first
|m / 44' / 1' / 1' / 0 / 0
|-
|Bitcoin Testnet
|second
|external
|second
|m / 44' / 1' / 1' / 0 / 1
|-
|Bitcoin Testnet
|second
|change
|first
|m / 44' / 1' / 1' / 1 / 0
|-
|Bitcoin Testnet
|second
|change
|second
|m / 44' / 1' / 1' / 1 / 1
|}

==4. Path levels==

We define the following 5 levels to identify interchain account:

====4-1. Purpose====

====4-2. Chain type====

====4-3. Account====

====4-4. Change====

====4-5. Index====
Index is for indexing multiple accounts generated in previous levels.

==5. Account discovery==
As in BIP44, when the master seed generated by mnemonic discover the accounts in the following manner:

derive the first account's node (index = 0)
derive the external chain node of this account
scan addresses of the external chain; respect the gap limit described below
if no transactions are found on the external chain, stop discovery
if there are some transactions, increase the account index and go to step 1

==6.Address gap limit==

==7. Registered chain types==

==8. Examples==

==9. Reference==

- [[https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki|BIP32 - Hierarchical Deterministic Wallets]] 

- [[https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki|BIP43 - Purpose Field for Deterministic Wallets]]  

- [[https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki|BIP44 - Multi-Account Hierarchy for Deterministic Wallets]]  
